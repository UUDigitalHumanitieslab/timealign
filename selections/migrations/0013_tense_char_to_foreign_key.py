# Generated by Django 2.2.12 on 2020-06-27 08:20

from django.db import migrations


def migrate_tense(apps, schema_editor):
    Selection = apps.get_model('selections', 'Selection')
    Tense = apps.get_model('annotations', 'Tense')

    for sel in Selection.objects.all():
        if not sel.tense:
            continue
        try:
            tense = Tense.objects.get(title=sel.tense, language=sel.fragment.language)
        except Tense.DoesNotExist:
            print('Tense does not exist: {}, (Selection {})'.format(sel.tense, sel.pk))
            raise
        sel.tense_new = tense
        sel.save()


def undo(apps, schema_editor):
    Selection = apps.get_model('selections', 'Selection')
    for sel in Selection.objects.all():
        sel.tense = sel.tense_new.title
        sel.save()


class Migration(migrations.Migration):

    dependencies = [
        ('selections', '0012_selection_tense_new'),
    ]

    operations = [
        migrations.RunPython(migrate_tense, undo)
    ]
