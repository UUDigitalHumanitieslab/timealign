{% extends "base/base.html" %}

{% load bootstrap3 %}

{% block content %}
<style>
.popover {
    max-width: 40em;
}

.selected {
    background-color: lightgreen;
}

.filtered {
    border: 1px solid black;
}
</style>

<div class="container">
    <h1>Annotations</h1>

    <table class="table table-striped">
        <thead>
            <tr>
                <th width="15%">Document</th>
                <th width="20%">Selected by/at</th>
                <th width="50%">Selected verb phrase</th>
                <th width="15%">Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for selection in selections %}
            <tr>
                {% with fragment=selection.fragment %}
                <td>{{ fragment.document.title }}</td>
                <td>{{ selection.selected_by }} (<em>{{ selection.selected_at|date:"j M Y, G:i" }}</em>)</td>
                <td>
                    <a title="Fragment" data-toggle="popover"
                       data-content='{% include "annotations/_sentences.html" with sentences=fragment.sentence_set.all annotated_words=selection.words.all filtered=filter.form.word_in_fragment.value %}'>
                        {{ fragment.selected_words }}
                    </a>
                </td>
                <td>
                    <a href="{% url 'selections:edit' selection.id %}" role="button" class="btn btn-default btn-xs" title="Edit">
                        <span class="glyphicon glyphicon-pencil" aria-hidden="true"></span>
                    </a>
                </td>
                {% endwith %}
            </tr>
            {% endfor %}
        </tbody>
    </table>

    {% if is_paginated %}
    {% bootstrap_pagination page_obj %}
    {% endif %}

    <h2>Filter</h2>
    <form action="" method="get">
        {% bootstrap_form filter.form %}
        {% bootstrap_button "Filter" button_type="submit" %}
    </form>
</div>

<script>
$(function() {
    $('[data-toggle="popover"]').popover({
        html: true,
        placement: "bottom",
    });
});
</script>
{% endblock %}
