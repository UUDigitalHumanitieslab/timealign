{% extends "base/base.html" %} {% load bootstrap3 %} {% block head %}
<script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.17/d3.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/nvd3/1.8.4/nv.d3.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/nvd3/1.8.4/nv.d3.css"> {% endblock %} {% block content %}
<h2>MDS visualization (scenario
    <em>
        <a href="{% url 'stats:show' scenario.pk %}" target="_blank">{{ scenario.title }}</a>
    </em>)</h2>
<p>
    <em>Stress: {{ stress|floatformat:"-3" }}</em>
</p>

<div class="alert alert-info alert-dismissable" role="alert">
    <button type="button" class="close" data-dismiss="alert" aria-label="Close">
        <span aria-hidden="true">&times;</span>
    </button>
    This scatter plot shows the results Multidimensional Scaling of the dissimilarity matrix of tense tuples. Please see the
    <a href="{% url 'project' %}" class="alert-link">project summary</a> for more details.
</div>

<div id="chart">
    <svg style="height: 490px; width: 100%"></svg>
</div>

<h2>Filters</h2>

<div class="alert alert-info alert-dismissable" role="alert">
    <button type="button" class="close" data-dismiss="alert" aria-label="Close">
        <span aria-hidden="true">&times;</span>
    </button>
    Below, you can change the labels and the dimensions displayed on the x- and y-axis. Click the green button to confirm your
    selection and update the scatter plot.
</div>

<div class="row">
    Language:
    <div id="language" class="btn-group" data-toggle="buttons">
        {% for l in languages %}
        <label class="btn btn-primary active">
            <input type="radio" name="options" value="{{ l.iso }}" autocomplete="off">{{ l.title }}
        </label>
        {% endfor %}
    </div>
    Dimension on x-axis:
    <div id="d1" class="btn-group" data-toggle="buttons">
        {% for d in max_dimensions %}
        <label class="btn btn-primary active">
            <input type="radio" name="options" value="{{ d }}" autocomplete="off">{{ d }}
        </label>
        {% endfor %}
    </div>
    Dimension on y-axis:
    <div id="d2" class="btn-group" data-toggle="buttons">
        <label class="btn btn-primary active">
            <input type="radio" name="options" value="0" autocomplete="off">&empty;
        </label>
        {% for d in max_dimensions %}
        <label class="btn btn-primary active">
            <input type="radio" name="options" value="{{ d }}" autocomplete="off">{{ d }}
        </label>
        {% endfor %}
    </div>
    <button type="submit" class="btn btn-success">
        {% bootstrap_icon "ok" %} Go!
    </button </div>

    <script>
        var d = {{ matrix | safe }};

        var width = parseInt(d3.select('#chart').style('width'), 10),
            height = parseInt(d3.select('#chart').style('height'), 10),
            x = d3.scale.linear().range([0, width]),
            y = d3.scale.linear().range([height, 0]),
            z = d3.scale.category10();

        var svg = d3.select("#chart")
            .append("svg")
            .attr("width", width)
            .attr("height", height)

        var n = d.length;

        x.domain([-.5, .5])
        y.domain([-.5, .5])

        var axis_x = d3.svg.axis(x)
            .tickFormat(d3.format('.02f')),
            axis_y = d3.svg.axis(y)
                .tickFormat(d3.format('.02f'))

        svg.append("g")
            .attr("id", "axis_x")
            .attr("transform", "translate(0," + (330 + 25) + ")")
            .call(axis_x);

        svg.append("g")
            .attr("id", "axis_y")
            .attr("transform", "translate(" + (85 / 2) + ", 0)")
            .call(axis_y);



    </script>

    <script>
        $(function () {
            $("#language input[value='{{ language }}'").closest(".btn").button("toggle");
            $("#d1 input[value='{{ d1 }}'").closest(".btn").button("toggle");
            $("#d2 input[value='{{ d2 }}'").closest(".btn").button("toggle");

            $("button[type='submit']").click(function () {
                var l = $("#language > .btn.active > input").val();
                var d1 = $("#d1 > .btn.active > input").val();
                var d2 = $("#d2 > .btn.active > input").val();
                var url = "{% url 'stats:mds' scenario.pk 'language' 1111 2222 %}";
                window.location = url.replace("language", l).replace('1111', d1).replace('2222', d2);
            });
        });


    </script> {% endblock %}