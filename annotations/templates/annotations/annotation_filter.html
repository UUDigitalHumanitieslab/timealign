{% extends "base/base.html" %}

{% load bootstrap3 %}

{% block content %}
<style>
.popover {
    max-width: 40em;
}

.selected {
    background-color: lightgreen;
}

.filtered {
    border: 1px solid black;
}
</style>

<div class="container">
    <h1>Annotations</h1>

    <table class="table table-striped">
        <thead>
            <tr>
                <th width="15%">Document</th>
                <th width="20%">Annotated by/at</th>
                <th width="25%">Source</th>
                <th width="30%">Translation</th>
                <th width="10%">Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for annotation in annotations %}
            <tr>
                {% with source=annotation.alignment.original_fragment translation=annotation.alignment.translated_fragment %}
                <td>{{ source.document.title }}</td>
                <td>{{ annotation.annotated_by }} (<em>{{ annotation.annotated_at|date:"j M Y, G:i" }}</em>)</td>
                <td>
                    <a title="Source fragment" data-toggle="popover"
                       data-content='{% include "annotations/_sentences.html" with sentences=source.sentence_set.all filtered=filter.form.word_in_source.value %}'>
                        {{ source.target_words }}
                    </a>
                </td>
                <td>
                    <a title="Translated fragment" data-toggle="popover"
                       data-content='{% include "annotations/_sentences.html" with sentences=translation.sentence_set.all annotated_words=annotation.words.all %}'>
                        {{ annotation.selected_words }} ({{ annotation.tense }})
                    </a>
                </td>
                <td>
                    <a href="{% url 'annotations:edit' annotation.id %}" role="button" class="btn btn-primary btn-xs" title="Edit">
                        <span class="glyphicon glyphicon-pencil" aria-hidden="true"></span>
                    </a>
                    <a href="{% url 'annotations:delete' annotation.id %}" role="button" class="btn btn-danger btn-xs" title="Delete">
                        <span class="glyphicon glyphicon-remove" aria-hidden="true"></span>
                    </a>
                </td>
                {% endwith %}
            </tr>
            {% endfor %}
        </tbody>
    </table>

    {% if is_paginated %}
    {% bootstrap_pagination page_obj %}
    {% endif %}

    <h2>Filter</h2>
    <form action="" method="get">
        {% bootstrap_form filter.form %}
        {% bootstrap_button "Filter" button_type="submit" %}
    </form>
</div>

<script>
$(function() {
    $('[data-toggle="popover"]').popover({
        html: true,
        placement: "bottom",
    });
});
</script>
{% endblock %}
