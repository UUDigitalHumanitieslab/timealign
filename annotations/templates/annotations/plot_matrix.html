{% extends "annotations/base.html" %}

{% load bootstrap3 %}

{% block head %}
<script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.17/d3.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/nvd3/1.8.4/nv.d3.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/nvd3/1.8.4/nv.d3.css">
{% endblock %}

{% block content %}
<div id="chart">
    <svg style="height: 600px; width: 800px"></svg>
</div>

<h3>Filters</h3>
<div class="row">
    Language:
    <div id="language" class="btn-group" data-toggle="buttons">
        {% for l in languages %}
        <label class="btn btn-primary active">
            <input type="radio" name="options" value="{{ l.0 }}" autocomplete="off">{{ l.1 }}
        </label>
        {% endfor %}
    </div>
    Dimensions 1:
    <div id="d1" class="btn-group" data-toggle="buttons">
        {% for d in max_dimensions %}
        <label class="btn btn-primary active">
            <input type="radio" name="options" value="{{ d }}" autocomplete="off">{{ d }}
        </label>
        {% endfor %}
    </div>
    Dimension 2:
    <div id="d2" class="btn-group" data-toggle="buttons">
        {% for d in max_dimensions %}
        <label class="btn btn-primary active">
            <input type="radio" name="options" value="{{ d }}" autocomplete="off">{{ d }}
        </label>
        {% endfor %}
    </div>
    <button type="submit" class="btn btn-primary">
        {% bootstrap_icon "ok" %} Go!
    </button>
</div>

<script>
    var matrix = {{ matrix|safe }};

    nv.addGraph(function() {
        var chart = nv.models.scatterChart()
            .color(d3.scale.category10().range())
            .forceX([-.5, .5])
            .forceY([-.5, .5]);

        //Axis settings
        chart.xAxis.tickFormat(d3.format('.02f'));
        chart.yAxis.tickFormat(d3.format('.02f'));

        //Configure how the tooltip looks.
        chart.tooltip.contentGenerator(function(e) {
            return '<h4>' + e.point.tenses + '</h4>';
        });

        chart.scatter.dispatch.on("elementClick", function(e) {
            window.location = "{% url 'annotations:show' 999 %}".replace(999, e.point.fragment_id);
        });

        d3.select('#chart svg')
            .datum(matrix)
            .transition()
            .duration(350)
            .call(chart);

        nv.utils.windowResize(chart.update);

        return chart;
    });
</script>

<script>
$(function() {
    $("#language input[value='{{ language }}'").closest(".btn").button("toggle");
    $("#d1 input[value='{{ d1 }}'").closest(".btn").button("toggle");
    $("#d2 input[value='{{ d2 }}'").closest(".btn").button("toggle");

    $("button[type='submit']").click(function() {
        var l = $("#language > .btn.active > input").val();
        var d1 = $("#d1 > .btn.active > input").val();
        var d2 = $("#d2 > .btn.active > input").val();
        var url = "{% url 'annotations:plot' 'language' 1111 2222 %}";
        window.location = url.replace("language", l).replace('1111', d1).replace('2222', d2);
    });
});
</script>
{% endblock %}
